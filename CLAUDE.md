# Claude アシスタント設定

このファイルには、このプロジェクトでClaudeがより良く支援するための指示とコンテキストが含まれています。

## プロジェクト概要
天文学プロジェクトで、以下を含みます：
- 自動領域推定機械学習モデル
- JupyterHubでの可視化を通した、天文学の演習問題と解説
- Kubernetesデプロイメント設定
- Terraformインフラストラクチャコード
- 天文学可視化プレイグラウンド

## 開発コマンド
- Python環境: 依存関係管理に`uv`を使用（pyproject.tomlを参照）
- データ分析と可視化にJupyterノートブック
- モデル訓練とサービング機能

## 主な可視化の例
Jupyter Notebookでは、以下のような天文学的なデータの可視化を扱います。
- **HR図（ヘルツシュプルング・ラッセル図）:** 恒星の絶対等級と色指数をプロットし、恒星の進化段階を分析します。
- **光度曲線:** 太陽系外惑星が主星の前を通過（トランジット）する際の光度の変化をプロットし、惑星の存在や半径を推定します。
- **スペクトル分析:** 恒星や銀河の光を波長ごとに分解し、その組成や赤方偏移を調査します。
- **天体の軌道シミュレーション:** 惑星や彗星の軌道を計算し、その動きをアニメーションで可視化します。
- **宇宙の大規模構造:** 銀河の三次元分布をプロットし、宇宙の泡構造を可視化します。

## 演習問題の作成方針
Jupyter Notebookを用いた演習問題と解説は、以下の観点を重視して作成します。
- **理論と実践の融合:** 各章の冒頭で天文学的な背景理論を簡潔に解説し、続く演習でPythonコードを用いてその理論を実際に計算・可視化することで、知識の定着を図ります。
- **可視化による直感的理解:** 数式や文章だけでは理解が難しい概念も、グラフやアニメーションとして可視化することで、直感的な理解を促します。学習者は自身のコードで天体現象を再現する体験を得られます。
- **段階的なステップ:** 各演習問題は、分析プロセスを体験できるよう、以下のような構造化されたセクションで構成します。 **1. 理論と目的の確認**、**2. データ準備と計算**、**3. 可視化と考察**。このステップ分割により、初学者でも無理なく取り組めます。
- **対話的な探求:** 学習者がコードのパラメータを自由に変更し、結果がどのように変わるかを探求できるような構成を目指します。能動的な試行錯誤を通じて、より深い学びを促します。
- **実データへの接続:** 可能な限り、実際の観測データやシミュレーションデータを使用し、天文学研究の現場で行われているデータ解析の初歩を体験できるようにします。

### フォーマットの統一とセル使用指針

**Markdownセルの使用**
- 理論的背景と物理概念の解説
- 数式と計算過程の詳細（LaTeX記法使用）
- データの分析結果と数値的まとめ（表形式推奨）
- 各段階での考察と物理的意味の解釈
- 学習成果の総括と次のステップへの橋渡し

**Pythonコードセルの使用**
- **可視化専用**: グラフ、図表、アニメーションの生成のみ
- ライブラリのインポートと初期設定
- 日本語フォント設定（各可視化セルの冒頭で必須）

### 日本語フォント設定の標準化

**各可視化セルの冒頭で必ず実行**
```python
# 日本語フォント設定（セル冒頭で必須）
import matplotlib.pyplot as plt
import japanize_matplotlib

plt.rcParams['font.family'] = ['IPAexGothic', 'DejaVu Sans']
plt.rcParams['mathtext.fontset'] = 'stix'
plt.rcParams['axes.unicode_minus'] = False
```

**推奨フォント階層**
1. `IPAexGothic` - 主要日本語フォント
2. `DejaVu Sans` - フォールバック英語フォント
3. システムデフォルト

**文字化け防止チェックリスト**
- 各可視化関数の冒頭でフォント設定を確認
- プロット後の日本語表示テスト
- 異なる環境での動作確認

### セル構成の実践例

**標準的な問題構成**
```
1. Markdownセル: 問題文と学習目的
2. Markdownセル: 理論的背景と学習ポイント
3. Markdownセル: 1. 理論と目的の確認
4. Markdownセル: 2. データ準備と計算（数式・表・結果）
5. Pythonセル: 3. 可視化と考察（フォント設定+グラフ生成）
6. Markdownセル: 学習成果と考察（物理的意味の解釈）
```

**計算の扱い方**
- 単純な数値計算: Markdownセル内に数式と結果を記載
- 複雑な計算過程: Markdownセル内で段階的に説明
- データ整理: Markdownセル内の表形式推奨
- 配列操作: 可視化に直結する場合のみPythonセル使用

**可視化コードの構造**
```python
def visualize_problem_name():
    """問題名の包括的可視化"""
    
    # 日本語フォント設定（必須）
    import matplotlib.pyplot as plt
    import japanize_matplotlib
    
    plt.rcParams['font.family'] = ['IPAexGothic', 'DejaVu Sans']
    plt.rcParams['mathtext.fontset'] = 'stix'
    plt.rcParams['axes.unicode_minus'] = False
    
    # データ定義
    # （Markdownで計算済みの値を使用）
    
    # 可視化処理
    fig, axes = plt.subplots(...)
    
    # グラフ作成
    
    plt.tight_layout()
    plt.show()

# 実行
visualize_problem_name()
```

## プロジェクト構造
- `auto_area_estimation/` - PyTorchを使った領域推定MLモデル
- `extreme_unraveling-the-universe/` - Jupyterノートブック形式の天文学教育コンテンツと演習問題
- `kubernetes/` - Helmチャートとデプロイメント設定
- `terraform/` - Infrastructure as Code
- `playground/` - HTMLビジュアライゼーション（日周運動）
- `scripts/` - 開発用ユーティリティスクリプト

## 重要な指示
**Claudeは必ず日本語で応答してください。すべての出力、説明、コメントは日本語で行ってください。**

## ツール・スクリプト開発ガイドライン

### 基本設計原則
- **シンプリシティ**: 機能を1つのスクリプトに統合し、ファイル数を最小限に抑える
- **ユーザビリティ**: 初心者でも直感的に使える明確なコマンド体系
- **保守性**: コードの可読性を重視し、適切なコメントと関数分割を行う
- **互換性**: 異なる環境（Linux/WSL/macOS）での動作を考慮する

### ディレクトリ構造の標準
```
scripts/
└── tool_name/
    ├── README.md           # 使用方法とトラブルシューティング
    ├── requirements.txt    # 依存ライブラリ（バージョン制約含む）
    ├── setup.sh           # 環境セットアップスクリプト
    └── main_tool.py       # メイン機能スクリプト
```

### コーディング規約
- **日本語対応**: 出力メッセージとコメントは日本語で記述
- **エラーハンドリング**: 明確なエラーメッセージと適切な終了コード
- **進捗表示**: 長時間の処理には進捗インジケーターを提供
- **ヘルプ機能**: `--help`オプションで詳細な使用方法を表示

### 依存関係管理
- **バージョン指定**: requirements.txtで互換性のあるバージョン範囲を指定
- **システム依存**: OSレベルの依存関係を setup.sh で自動インストール
- **フォールバック**: インストール失敗時の代替手段を提供

### セキュリティ考慮事項
- **権限最小化**: 必要最小限の権限で動作するよう設計
- **入力検証**: ユーザー入力の妥当性チェックを徹底
- **パス処理**: Path オブジェクトを使用した安全なファイル操作

### ドキュメント化
- **README.md**: 目的、使用方法、トラブルシューティングを含む
- **インラインコメント**: 複雑な処理にはコメントで説明を追加
- **使用例**: 実際の使用場面に基づいた具体例を提示

### テスト・検証
- **機能テスト**: 基本機能の動作確認を setup.sh に組み込む
- **環境確認**: 必要な依存関係の存在チェック
- **エラーケース**: 一般的なエラー条件での動作検証

## 注意事項
- 機械学習モデルにPyTorchを使用
- インタラクティブ開発にJupyterノートブック
- JupyterHubとCoderを使ったKubernetes設定
- 天文学の概念とデータ分析に教育的焦点